<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Downloader - Extension Test Page</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }

    h1 {
      color: #1a73e8;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #666;
      font-size: 18px;
      margin-bottom: 32px;
    }

    .instructions {
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 32px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .instructions h2 {
      margin-top: 0;
      color: #1a73e8;
    }

    .instructions ol {
      padding-left: 24px;
    }

    .instructions li {
      margin-bottom: 12px;
    }

    .instructions code {
      background: #f0f0f0;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .section {
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .section h2 {
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .badge {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 500;
    }

    .badge-download {
      background: #e6f4ea;
      color: #137333;
    }

    .badge-skip {
      background: #fce8e6;
      color: #c5221f;
    }

    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .image-card {
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      overflow: hidden;
      background: #fafafa;
      transition: border-color 0.2s;
    }

    .image-card.should-download {
      border-color: #34a853;
    }

    .image-card.should-skip {
      border-color: #ea4335;
    }

    .image-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .image-info {
      padding: 16px;
    }

    .image-title {
      font-weight: 600;
      margin-bottom: 8px;
    }

    .image-details {
      font-size: 13px;
      color: #666;
    }

    .image-details span {
      display: block;
      margin-bottom: 4px;
    }

    .indicator {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      margin-top: 8px;
    }

    .indicator-download {
      background: #e6f4ea;
      color: #137333;
    }

    .indicator-skip {
      background: #fce8e6;
      color: #c5221f;
    }

    .dynamic-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e0e0e0;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
    }

    button:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background-color: #1a73e8;
      color: white;
    }

    .btn-primary:hover {
      background-color: #1557b0;
    }

    .btn-secondary {
      background-color: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background-color: #e0e0e0;
    }

    #dynamicContainer {
      min-height: 100px;
      border: 2px dashed #ccc;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      transition: all 0.3s;
    }

    #dynamicContainer.has-image {
      border-style: solid;
      border-color: #34a853;
      color: #333;
      flex-direction: column;
    }

    #dynamicContainer img {
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
    }

    .status-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 16px;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 16px;
    }

    .status-log .log-entry {
      margin-bottom: 4px;
    }

    .status-log .log-time {
      color: #808080;
    }

    .status-log .log-success {
      color: #4ec9b0;
    }

    .status-log .log-info {
      color: #9cdcfe;
    }

    .bg-image-demo {
      width: 100%;
      height: 200px;
      border-radius: 8px;
      background-size: cover;
      background-position: center;
      margin-top: 16px;
    }

    .note {
      background: #fff8e1;
      border-left: 4px solid #f9a825;
      padding: 12px 16px;
      border-radius: 0 8px 8px 0;
      font-size: 14px;
      margin-top: 16px;
    }

    .note strong {
      color: #5d4037;
    }

    footer {
      text-align: center;
      padding: 24px;
      color: #999;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>Image Downloader - Test Page</h1>
  <p class="subtitle">Use this page to verify your extension is working correctly</p>

  <div class="instructions">
    <h2>Testing Instructions</h2>
    <ol>
      <li>Make sure the Image Downloader extension is <strong>installed and enabled</strong></li>
      <li>Open the extension popup and ensure <strong>Enable Downloads</strong> is ON</li>
      <li>Set <strong>Minimum Size</strong> to <code>600</code> pixels (the default)</li>
      <li>Open this page - images should start downloading automatically</li>
      <li>Check your <code>Downloads/downloaded-images/</code> folder for results</li>
      <li>Use the <strong>MutationObserver Test</strong> section below to test dynamic image loading</li>
    </ol>
    <div class="note">
      <strong>Expected Results:</strong> With a 600px minimum, 4 large images should download.
      The 4 small images (under 600px) should be skipped.
    </div>
  </div>

  <div class="section">
    <h2>
      Large Images - Should Download
      <span class="badge badge-download">4 images</span>
    </h2>
    <p>These images are all larger than 600px and should trigger automatic downloads.</p>

    <div class="image-grid">
      <div class="image-card should-download">
        <img src="https://picsum.photos/800/600" alt="Large image 800x600">
        <div class="image-info">
          <div class="image-title">Landscape Photo</div>
          <div class="image-details">
            <span>Dimensions: <strong>800 x 600</strong></span>
            <span>Max dimension: 800px</span>
          </div>
          <span class="indicator indicator-download">Should Download</span>
        </div>
      </div>

      <div class="image-card should-download">
        <img src="https://picsum.photos/1200/800" alt="Large image 1200x800">
        <div class="image-info">
          <div class="image-title">High-Res Landscape</div>
          <div class="image-details">
            <span>Dimensions: <strong>1200 x 800</strong></span>
            <span>Max dimension: 1200px</span>
          </div>
          <span class="indicator indicator-download">Should Download</span>
        </div>
      </div>

      <div class="image-card should-download">
        <img src="https://picsum.photos/600/900" alt="Portrait image 600x900">
        <div class="image-info">
          <div class="image-title">Portrait Photo</div>
          <div class="image-details">
            <span>Dimensions: <strong>600 x 900</strong></span>
            <span>Max dimension: 900px</span>
          </div>
          <span class="indicator indicator-download">Should Download</span>
        </div>
      </div>

      <div class="image-card should-download">
        <img src="https://picsum.photos/1000/1000" alt="Square image 1000x1000">
        <div class="image-info">
          <div class="image-title">Square Photo</div>
          <div class="image-details">
            <span>Dimensions: <strong>1000 x 1000</strong></span>
            <span>Max dimension: 1000px</span>
          </div>
          <span class="indicator indicator-download">Should Download</span>
        </div>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>
      Small Images - Should NOT Download
      <span class="badge badge-skip">4 images</span>
    </h2>
    <p>These images are smaller than 600px in both dimensions and should be skipped.</p>

    <div class="image-grid">
      <div class="image-card should-skip">
        <img src="https://picsum.photos/400/300" alt="Small image 400x300">
        <div class="image-info">
          <div class="image-title">Small Thumbnail</div>
          <div class="image-details">
            <span>Dimensions: <strong>400 x 300</strong></span>
            <span>Max dimension: 400px</span>
          </div>
          <span class="indicator indicator-skip">Should Skip</span>
        </div>
      </div>

      <div class="image-card should-skip">
        <img src="https://picsum.photos/200/200" alt="Tiny image 200x200">
        <div class="image-info">
          <div class="image-title">Icon Size</div>
          <div class="image-details">
            <span>Dimensions: <strong>200 x 200</strong></span>
            <span>Max dimension: 200px</span>
          </div>
          <span class="indicator indicator-skip">Should Skip</span>
        </div>
      </div>

      <div class="image-card should-skip">
        <img src="https://picsum.photos/500/400" alt="Medium-small image 500x400">
        <div class="image-info">
          <div class="image-title">Medium Preview</div>
          <div class="image-details">
            <span>Dimensions: <strong>500 x 400</strong></span>
            <span>Max dimension: 500px</span>
          </div>
          <span class="indicator indicator-skip">Should Skip</span>
        </div>
      </div>

      <div class="image-card should-skip">
        <img src="https://picsum.photos/100/100" alt="Tiny icon 100x100">
        <div class="image-info">
          <div class="image-title">Tiny Icon</div>
          <div class="image-details">
            <span>Dimensions: <strong>100 x 100</strong></span>
            <span>Max dimension: 100px</span>
          </div>
          <span class="indicator indicator-skip">Should Skip</span>
        </div>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>
      Edge Case - Exactly 600px
      <span class="badge badge-download">Should Download</span>
    </h2>
    <p>This image is exactly 600px wide. It should download since the filter uses "greater than or equal to".</p>

    <div class="image-grid">
      <div class="image-card should-download">
        <img src="https://picsum.photos/600/400" alt="Edge case 600x400">
        <div class="image-info">
          <div class="image-title">Exactly 600px Wide</div>
          <div class="image-details">
            <span>Dimensions: <strong>600 x 400</strong></span>
            <span>Max dimension: 600px (boundary)</span>
          </div>
          <span class="indicator indicator-download">Should Download</span>
        </div>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>
      CSS Background Image Test
      <span class="badge badge-download">1 background</span>
    </h2>
    <p>The extension also detects images set via CSS background-image property.</p>

    <div class="bg-image-demo" style="background-image: url('https://picsum.photos/900/400');">
    </div>
    <div class="image-info" style="margin-top: 12px;">
      <div class="image-details">
        <span>CSS background-image: <strong>900 x 400</strong></span>
        <span>This should also be downloaded (after ~1 second delay)</span>
      </div>
      <span class="indicator indicator-download">Should Download</span>
    </div>
  </div>

  <div class="section">
    <h2>MutationObserver Test</h2>
    <p>Test that the extension detects dynamically added images (like infinite scroll or lazy loading).</p>

    <div class="button-group">
      <button class="btn-primary" id="addLargeImage">Add Large Image (800x600)</button>
      <button class="btn-secondary" id="addSmallImage">Add Small Image (300x200)</button>
      <button class="btn-secondary" id="clearImages">Clear Dynamic Images</button>
    </div>

    <div id="dynamicContainer">
      Click a button above to dynamically add an image
    </div>

    <div class="status-log" id="statusLog">
      <div class="log-entry"><span class="log-time">[Ready]</span> <span class="log-info">Click buttons to test MutationObserver detection</span></div>
    </div>

    <div class="note">
      <strong>How it works:</strong> When you click "Add Large Image", a new image element is created
      via JavaScript. The extension's MutationObserver should detect this and trigger a download.
    </div>
  </div>

  <footer>
    Image Downloader Extension Test Page &bull; All test images provided by <a href="https://picsum.photos" target="_blank">Lorem Picsum</a>
  </footer>

  <script>
    const dynamicContainer = document.getElementById('dynamicContainer');
    const statusLog = document.getElementById('statusLog');
    let imageCount = 0;

    function logMessage(message, type = 'info') {
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-${type}">${message}</span>`;
      statusLog.appendChild(entry);
      statusLog.scrollTop = statusLog.scrollHeight;
    }

    document.getElementById('addLargeImage').addEventListener('click', () => {
      imageCount++;
      const timestamp = Date.now();

      // Create a new image element dynamically
      const img = document.createElement('img');
      img.src = `https://picsum.photos/800/600?random=${timestamp}`;
      img.alt = `Dynamic large image ${imageCount}`;
      img.style.marginTop = '12px';

      // Clear placeholder text and add image
      dynamicContainer.innerHTML = '';
      dynamicContainer.classList.add('has-image');

      const label = document.createElement('p');
      label.innerHTML = `<strong>Dynamic Image #${imageCount}</strong> (800x600 - Should Download)`;
      label.style.marginTop = '12px';

      dynamicContainer.appendChild(img);
      dynamicContainer.appendChild(label);

      logMessage(`Added large image (800x600) - Extension should download this`, 'success');
    });

    document.getElementById('addSmallImage').addEventListener('click', () => {
      imageCount++;
      const timestamp = Date.now();

      const img = document.createElement('img');
      img.src = `https://picsum.photos/300/200?random=${timestamp}`;
      img.alt = `Dynamic small image ${imageCount}`;
      img.style.marginTop = '12px';

      dynamicContainer.innerHTML = '';
      dynamicContainer.classList.add('has-image');
      dynamicContainer.style.borderColor = '#ea4335';

      const label = document.createElement('p');
      label.innerHTML = `<strong>Dynamic Image #${imageCount}</strong> (300x200 - Should NOT Download)`;
      label.style.marginTop = '12px';

      dynamicContainer.appendChild(img);
      dynamicContainer.appendChild(label);

      logMessage(`Added small image (300x200) - Extension should SKIP this`, 'info');
    });

    document.getElementById('clearImages').addEventListener('click', () => {
      dynamicContainer.innerHTML = 'Click a button above to dynamically add an image';
      dynamicContainer.classList.remove('has-image');
      dynamicContainer.style.borderColor = '';
      imageCount = 0;
      logMessage('Cleared dynamic images', 'info');
    });

    // Log when page loads
    window.addEventListener('load', () => {
      logMessage('Page loaded - Static images should be processing', 'info');
    });
  </script>
</body>
</html>
